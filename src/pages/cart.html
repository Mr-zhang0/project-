<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="../sass/cart.css" />
    <link rel="stylesheet" href="../lib/jquery/dist/jquery.min.js" />
  </head>
  <body>
    <div class="cartTitle pull-right">
      <span>已选商品 (不含运费)</span>
      <span id="cartTitlePrice" class="cartTitlePrice">￥0.00</span>
      <button
        class="createOrderButton"
        style="background-color: rgb(170, 170, 170);"
        disabled="disabled"
      >
        结 算
      </button>
    </div>
    <div class="cartProductList">
      <table class="cartProductTable">
        <thead>
          <tr>
            <th class="selectAndImage">
              <img
                src="http://how2j.cn/tmall/img/site/cartNotSelected.png"
                class="selectAllItem"
                selectit="false"
              />
              全选
            </th>
            <th>商品信息</th>
            <th>单价</th>
            <th>数量</th>
            <th width="120px">金额</th>
            <th class="operation">操作</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <div class="shopId">
                <img
                  src="http://how2j.cn/tmall/img/site/cartNotSelected.png"
                  class="selectAllItem"
                  selectit="false"
                />
                <img
                  src="https://ss2.bdstatic.com/8_V1bjqh_Q23odCf/pacific/1919701784.jpg"
                  width="30"
                  height="20"
                />
                <a href="#nowhere">店铺：华为官方旗舰店</a>
              </div>
            </td>
          </tr>

          <tr class="cartProductItemTR" oiid="936">
            <td>
              <img
                src="http://how2j.cn/tmall/img/site/cartNotSelected.png"
                class="cartProductItemIfSelected"
                oiid="936"
                selectit="false"
              />
              <a href="#nowhere" style="display:none"
                ><img src="http://how2j.cn/tmall/img/site/cartSelected.png"
              /></a>
              <img
                src="https://img.alicdn.com/bao/uploaded/i4/TB1yVcUNQPoK1RjSZKbytX1IXXa_112407.jpg_80x80.jpg"
                class="cartProductImg"
              />
            </td>
            <td>
              <div class="cartProductLinkOutDiv">
                <a class="cartProductLink" href="#nowhere"
                  >【12期免息】Huawei/华为P30
                  Pro曲面屏超感光徕卡四摄变焦双景录像980智能手机</a
                >
                <div>
                  <img
                    src="https://gw.alicdn.com/tfs/TB1XY8mheH2gK0jSZFEXXcqMpXa-63-16.png"
                  />
                </div>
                <div class="cartProductLinkInnerDiv">
                  <img
                    title="支持信用卡支付"
                    src="http://how2j.cn/tmall/img/site/creditcard.png"
                  />
                  <img
                    title="消费者保障服务,承诺7天退货"
                    src="http://how2j.cn/tmall/img/site/7day.png"
                  />
                  <img
                    title="消费者保障服务,承诺如实描述"
                    src="http://how2j.cn/tmall/img/site/promise.png"
                  />
                </div>
              </div>
            </td>
            <td>
              <span class="cartProductItemPromotionPrice">￥4988.00</span>
            </td>
            <td>
              <div class="cartProductChangeNumberDiv">
                <span pid="365" class="hidden orderItemStock ">75</span>
                <span pid="365" class="hidden orderItemPromotePrice "
                  >5306.0</span
                >
                <a href="#nowhere" class="numberMinus" pid="365">-</a>
                <input
                  value="1"
                  autocomplete="off"
                  class="orderItemNumberSetting"
                  oiid="936"
                  pid="365"
                />
                <a href="#nowhere" class="numberPlus" pid="365" stock="75">+</a>
              </div>
            </td>
            <td>
              <span
                pid="365"
                oiid="936"
                id="cartProductItemSmallSumPrice"
                class="cartProductItemSmallSumPrice"
              >
                ￥4988.00
              </span>
            </td>
            <td>
              <a href="#nowhere" oiid="936" class="deleteOrderItem">删除</a>
            </td>
          </tr>
          <tr
            class="cartProductItemTR"
            oiid="935"
            style="background-color: rgb(255, 255, 255);"
          >
            <td>
              <img
                src="http://how2j.cn/tmall/img/site/cartNotSelected.png"
                class="cartProductItemIfSelected"
                oiid="935"
                selectit="false"
              />
              <a href="#nowhere" style="display:none"
                ><img src="http://how2j.cn/tmall/img/site/cartSelected.png"
              /></a>
              <img
                src="https://img.alicdn.com/bao/uploaded/i2/279470743/O1CN01UTTklQ1HMKmu9Xpuw_!!0-item_pic.jpg_80x80.jpg"
                class="cartProductImg"
              />
            </td>
            <td>
              <div class="cartProductLinkOutDiv">
                <a class="cartProductLink" href="#nowhere"
                  >塔菲克
                  耳机原装正品入耳式通用男女生有线6s适用iPhone苹果vivo华为小米oppo手机安卓x9x20r15r17高音质耳塞</a
                >
                <div class="cartProductLinkInnerDiv">
                  <img
                    title="支持信用卡支付"
                    src="http://how2j.cn/tmall/img/site/creditcard.png"
                  />
                  <img
                    title="消费者保障服务,承诺7天退货"
                    src="http://how2j.cn/tmall/img/site/7day.png"
                  />
                  <img
                    title="消费者保障服务,承诺如实描述"
                    src="http://how2j.cn/tmall/img/site/promise.png"
                  />
                </div>
              </div>
            </td>
            <td>
              <span class="cartProductItemOringalPrice">￥59.48</span>
              <span class="cartProductItemPromotionPrice">￥43.80</span>
            </td>
            <td>
              <div class="cartProductChangeNumberDiv">
                <span pid="809" class="hidden orderItemStock ">17</span>
                <span pid="809" class="hidden orderItemPromotePrice "
                  >152.75</span
                >
                <a href="#nowhere" class="numberMinus" pid="809">-</a>
                <input
                  value="1"
                  autocomplete="off"
                  class="orderItemNumberSetting"
                  oiid="935"
                  pid="809"
                />
                <a href="#nowhere" class="numberPlus" pid="809" stock="17">+</a>
              </div>
            </td>
            <td>
              <span
                pid="809"
                oiid="935"
                id="cartProductItemSmallSumPrice"
                class="cartProductItemSmallSumPrice"
              >
                ￥152.75
              </span>
            </td>
            <td>
              <a href="#nowhere" oiid="935" class="deleteOrderItem">删除</a>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="cartFoot">
      <img
        src="http://how2j.cn/tmall/img/site/cartNotSelected.png"
        class="selectAllItem"
        selectit="false"
      />
      <span>全选</span>
      <!--         <a href="#">删除</a> -->
      <div class="pull-right">
        <span
          >已选商品
          <span id="cartSumNumber" class="cartSumNumber">0</span> 件</span
        >
        <span>合计 (不含运费): </span>
        <span id="cartSumPrice" class="cartSumPrice">￥0.00</span>
        <button
          class="createOrderButton"
          style="background-color: rgb(170, 170, 170);"
          disabled="disabled"
        >
          结 算
        </button>
      </div>
    </div>
  </body>
  <script src="../lib/jquery/dist/jquery.min.js"></script>
  <script>
    $(function() {
      //点击产品选择框
      $("img.cartProductItemIfSelected").click(function() {
        var selectit = $(this).attr("selectit");
        if ("selectit" == selectit) {
          $(this).attr(
            "src",
            "http://how2j.cn/tmall/img/site/cartNotSelected.png"
          );
          $(this).attr("selectit", "false");
          $(this)
            .parents("tr.cartProductItemTR")
            .css("background-color", "#fff");
          syncSelect();
          syncCreateOrderButton();
          removePrice();
        } else {
          $(this).attr(
            "src",
            "http://how2j.cn/tmall/img/site/cartSelected.png"
          );
          $(this).attr("selectit", "selectit");
          $(this)
            .parents("tr.cartProductItemTR")
            .css("background-color", "#FFF8E1");
          syncSelect();
          syncCreateOrderButton();
          getPrice();
        }
      });
      //点击全选选择框
      $("img.selectAllItem").click(function() {
        var selectit = $(this).attr("selectit");
        if ("selectit" == selectit) {
          $("img.selectAllItem").attr(
            "src",
            "http://how2j.cn/tmall/img/site/cartNotSelected.png"
          );
          $("img.selectAllItem").attr("selectit", "false");
          $("img.cartProductItemIfSelected").attr(
            "src",
            "http://how2j.cn/tmall/img/site/cartNotSelected.png"
          );
          $("img.cartProductItemIfSelected").attr("selectit", "false");
          $("img.cartProductItemIfSelected")
            .parents("tr.cartProductItemTR")
            .css("background-color", "#fff");
          removePrice();
        } else {
          $("img.selectAllItem").attr(
            "src",
            "http://how2j.cn/tmall/img/site/cartSelected.png"
          );
          $("img.selectAllItem").attr("selectit", "selectit");
          $("img.cartProductItemIfSelected").attr(
            "src",
            "http://how2j.cn/tmall/img/site/cartSelected.png"
          );
          $("img.cartProductItemIfSelected").attr("selectit", "selectit");
          $("img.cartProductItemIfSelected")
            .parents("tr.cartProductItemTR")
            .css("background-color", "#FFF8E1");
          getPrice();
        }
      });
      //键盘输入数量
      $(".orderItemNumberSetting").keyup(function() {
        var pid = $(this).attr("pid");
        var stock = $("span.orderItemStock[pid=" + pid + "]").text();
        var price = $("span.orderItemPromotePrice[pid=" + pid + "]").text();
        var num = $(".orderItemNumberSetting[pid=" + pid + "]").val();
        num = parseInt(num);
        if (isNaN(num)) {
          num = 1;
        }
        if (num <= 0) num = 1;
        if (num > stock) num = stock;
        $(".orderItemNumberSetting[pid=" + pid + "]").val(num);
        //改变金额
        price = convertNumber(price) * num;
        price = parseFloat(price).toFixed(2);
        $(".cartProductItemSmallSumPrice[pid=" + pid + "]").html("￥" + price);
        getPrice();
      });
      //点击+增加数量
      $(".numberPlus").click(function() {
        var pid = $(this).attr("pid");
        var stock = $("span.orderItemStock[pid=" + pid + "]").text();
        var price = $("span.orderItemPromotePrice[pid=" + pid + "]").text();
        var num = $(".orderItemNumberSetting[pid=" + pid + "]").val();
        ++num;
        $(".orderItemNumberSetting[pid=" + pid + "]").val(num);
        price = convertNumber(price) * num;
        price = parseFloat(price).toFixed(2);
        $(".cartProductItemSmallSumPrice[pid=" + pid + "]").html("￥" + price);
        getPrice();
      });
      //点击-减少数量
      $(".numberMinus").click(function() {
        var pid = $(this).attr("pid");
        var stock = $("span.orderItemStock[pid=" + pid + "]").text();
        var price = $("span.orderItemPromotePrice[pid=" + pid + "]").text();
        var num = $(".orderItemNumberSetting[pid=" + pid + "]").val();
        --num;
        if (num == 0) num = 1;
        $(".orderItemNumberSetting[pid=" + pid + "]").val(num);
        price = convertNumber(price) * num;
        price = parseFloat(price).toFixed(2);
        $(".cartProductItemSmallSumPrice[pid=" + pid + "]").html("￥" + price);
        getPrice();
      });
    });
    //全选函数
    function syncSelect() {
      var selectAll = true;
      $(".cartProductItemIfSelected").each(function() {
        if ("false" == $(this).attr("selectit")) {
          selectAll = false;
        }
      });
      if (selectAll) {
        $("img.selectAllItem").attr(
          "src",
          "http://how2j.cn/tmall/img/site/cartSelected.png"
        );
      } else {
        $("img.selectAllItem").attr(
          "src",
          "http://how2j.cn/tmall/img/site/cartNotSelected.png"
        );
      }
    }

    function syncCreateOrderButton() {
      var selectAny = false;
      $(".cartProductItemIfSelected").each(function() {
        if ("selectit" == $(this).attr("selectit")) {
          selectAny = true;
        }
      });
      if (selectAny) {
        $("button.createOrderButton").css("background-color", "#C40000");
        $("button.createOrderButton").removeAttr("disabled");
      } else {
        $("button.createOrderButton").css("background-color", "#AAAAAA");
        $("button.createOrderButton").attr("disabled", "disabled");
      }
    }
    //获取产品金额
    function getPrice() {
      var price;
      var oiid;
      var sumPrice = 0;
      var sumNum = 0;
      $(".cartProductItemIfSelected").each(function() {
        if ("selectit" == $(this).attr("selectit")) {
          oiid = $(this).attr("oiid");
          pid = $(".orderItemNumberSetting[oiid=" + oiid + "]").attr("pid");
          num = $(".orderItemNumberSetting[pid=" + pid + "]").val();
          sumNum = parseInt(sumNum) + parseInt(num);
          if (isNaN(sumNum)) {
            sumNum = 1;
          }
          price = $(".cartProductItemSmallSumPrice[oiid=" + oiid + "]").text();
          price = convertNumber(price);
          sumPrice = parseFloat(sumPrice) + parseFloat(price);
          sumPrice = parseFloat(sumPrice).toFixed(2);
          creatSumPrice(sumPrice, sumNum);
        }
      });
    }

    function convertNumber(price) {
      price = price.replace(/\￥|\,/g, "");
      price = parseFloat(price).toFixed(2);
      return price;
    }
    //将计算后的金额数转化成页面展示的价格，也就是增加价格符号
    function creatSumPrice(sumPrice, sumMumber) {
      document.getElementById("cartSumPrice").innerHTML = "￥" + sumPrice;
      document.getElementById("cartTitlePrice").innerHTML = "￥" + sumPrice;
      document.getElementById("cartSumNumber").innerHTML = sumMumber;
    }
    //初始化价格
    function removePrice() {
      document.getElementById("cartSumPrice").innerHTML = "￥0.00";
      document.getElementById("cartTitlePrice").innerHTML = "￥0.00";
      document.getElementById("cartSumNumber").innerHTML = "0";
    }
  </script>
</html>
